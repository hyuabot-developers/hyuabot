"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9554],{9554:(M,d,l)=>{l.r(d),l.d(d,{ShuttleTimetableModule:()=>k});var n=l(5056),g=l(6895),T=l(4006),h=l(6753),c=l(7885),m=l(9671),p=l(4964),t=l(6353),b=l(7179),y=l(4471);const S=function(s,o){return{hour:s,minute:o}};function f(s,o){if(1&s&&(t.TgZ(0,"ion-item",11)(1,"ion-label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-text"),t._uU(5),t.ALo(6,"translate"),t.qZA()()),2&s){const e=o.$implicit,i=o.index,a=t.oxw();t.Q6J("lines",i===a.shuttleTimetableList.length-1?"none":"inset"),t.xp6(1),t.Tol(e.shuttleType),t.xp6(1),t.Oqu(t.lcZ(3,5,"shuttle.type."+e.shuttleType)),t.xp6(3),t.Oqu(t.xi3(6,7,"shuttle.timetable.item.all",t.WLB(10,S,e.shuttleTime.split(":")[0],e.shuttleTime.split(":")[1])))}}const v=p.Ps`
    query GetShuttlePeriod($currentDate: String!) {
      shuttle {
        weekday (date: $currentDate),
        period (date: $currentDate)
      }
    }
  `,D=p.Ps`
    query GetShuttleTimetable($period: String!) {
      shuttle {
        timetable (period: $period) {
          period, weekday, startStop, shuttleTime, shuttleType
        }
      }
    }
  `,w=[{path:"",component:(()=>{class s{constructor(e,i,a,u,r,Z){this.route=e,this.apollo=i,this.toastController=a,this.translateService=u,this.shuttleService=r,this.loadingService=Z,this.shuttleTimetableList=[],this.period="semester",this.now=new Date}ngOnInit(){const e=new Date;this.shuttleDateSubscription=this.apollo.watchQuery({query:v,variables:{currentDate:`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`}}).valueChanges.subscribe(({data:i})=>{this.period=i.shuttle.period,this.shuttleService.weekday.next(i.shuttle.weekday),this.shuttleDateSubscription?.unsubscribe(),this.shuttleTimetableQueryRef=this.apollo.watchQuery({query:D,pollInterval:6e4,variables:{period:this.period}}),this.shuttleTimetableSubscription=this.shuttleTimetableQueryRef.valueChanges.subscribe(({data:u,loading:r})=>{this.shuttleService.setLoading(r),this.shuttleService.setShuttleTimetable(u.shuttle.timetable),this.now=new Date,this.shuttleTimetableList=this.getShuttleTimetable()})}),this.shuttleService.loading.subscribe(i=>{i&&this.loadingService.present("shuttle.loading","shuttle.loading").then(()=>{this.shuttleService.loading.subscribe(a=>{a||this.loadingService.dismiss("shuttle.loading").then()})})}),this.shuttleService.weekday.subscribe(i=>{this.showCurrentWeekdays(i).then()}),this.route.queryParams.subscribe(i=>{this.destination=i.destination,this.stop=i.stop})}ngOnDestroy(){this.shuttleDateSubscription?.unsubscribe(),this.shuttleTimetableSubscription?.unsubscribe()}getShuttleTimetable(){return this.shuttleService.shuttleTimetable.value.filter(e=>this.checkDestination(e)&&("dormitory"===e.startStop.toLowerCase()||"dormitory"!==this.stop)&&e.weekday===this.shuttleService.weekday.value).map(e=>({period:e.period,shuttleTime:this.addTimeDelta(e),shuttleType:e.shuttleType,startStop:e.startStop}))}changeWeekday(){this.shuttleService.weekday.next("weekdays"===this.shuttleService.weekday.value?"weekends":"weekdays")}checkDestination(e){if("dormitory"===this.stop||"shuttlecock_o"===this.stop){if("station"===this.destination)return"C"===e.shuttleType||"DH"===e.shuttleType||"DJ"===e.shuttleType;if("terminal"===this.destination)return"C"===e.shuttleType||"DY"===e.shuttleType;if("jungang"===this.destination)return"DJ"===e.shuttleType}else if("station"===this.stop){if("campus"===this.destination)return"C"===e.shuttleType||"DH"===e.shuttleType||"DJ"===e.shuttleType;if("terminal"===this.destination)return"C"===e.shuttleType;if("jungang"===this.destination)return"DJ"===e.shuttleType}else{if("jungang"===this.stop)return"DJ"===e.shuttleType;if("terminal"===this.stop&&"campus"===this.destination)return"C"===e.shuttleType||"DY"===e.shuttleType;if("shuttlecock_i"===this.stop)return!0}}calculateTimeDelta(e){switch(this.stop){case"dormitory":return-5;case"shuttlecock_o":return 0;case"station":return 10;case"jungang":return 13;case"terminal":return"DY"===e?10:15;case"shuttlecock_i":return"C"!==e?15:20;default:return 999}}addTimeDelta(e){const[i,a,u]=e.shuttleTime.split(":"),r=new Date(this.now.getFullYear(),this.now.getMonth(),this.now.getDate(),parseInt(i,10),parseInt(a,10));return r.setMinutes(r.getMinutes()+this.calculateTimeDelta(e.shuttleType)),String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0")}showCurrentWeekdays(e){var i=this;return(0,m.Z)(function*(){yield(yield i.toastController.create({message:i.translateService.instant("shuttle.timetable."+e),buttons:[{text:i.translateService.instant("OK"),role:"cancel"}],cssClass:"toast-closest-stop",duration:1500})).present()})()}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(c.gz),t.Y36(p._M),t.Y36(n.yF),t.Y36(h.sK),t.Y36(b.U),t.Y36(y.b))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-shuttle-timetable"]],decls:18,vars:9,consts:[[3,"translucent"],["slot","start"],["defaultHref","/shuttle"],[3,"fullscreen"],["collapse","condense"],["size","large"],["lines","inset"],[3,"lines",4,"ngFor","ngForOf"],["vertical","bottom","horizontal","end","slot","fixed",2,"margin-bottom","10px","margin-right","10px"],[3,"click"],["name","swap-horizontal-outline"],[3,"lines"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t._UZ(3,"ion-back-button",2),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA()()(),t.TgZ(7,"ion-content",3)(8,"ion-header",4)(9,"ion-toolbar")(10,"ion-title",5),t._uU(11),t.ALo(12,"translate"),t.qZA()()(),t.TgZ(13,"ion-list",6),t.YNc(14,f,7,13,"ion-item",7),t.qZA(),t.TgZ(15,"ion-fab",8)(16,"ion-fab-button",9),t.NdJ("click",function(){return i.changeWeekday()}),t._UZ(17,"ion-icon",10),t.qZA()()()),2&e&&(t.Q6J("translucent",!0),t.xp6(5),t.hij(" ",t.lcZ(6,5,"shuttle.timetable.title."+i.stop)," "),t.xp6(2),t.Q6J("fullscreen",!0),t.xp6(4),t.Oqu(t.lcZ(12,7,"shuttle.timetable.title."+i.stop)),t.xp6(3),t.Q6J("ngForOf",i.shuttleTimetableList))},dependencies:[n.oU,n.Sm,n.W2,n.IJ,n.W4,n.Gu,n.gu,n.Ie,n.Q$,n.q_,n.yW,n.wd,n.sr,n.cs,g.sg,h.X$],styles:["ion-list[_ngcontent-%COMP%]{padding:20px;margin-bottom:60px;--ion-item-background: var(--ion-background-color)}.DH[_ngcontent-%COMP%]{color:red;font-weight:700}.DY[_ngcontent-%COMP%]{color:green;font-weight:700}.C[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-weight:700}"]}),s})()}];let C=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[c.Bz.forChild(w),c.Bz]}),s})(),k=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[n.Pc,g.ez,T.u5,h.aw,C]}),s})()}}]);