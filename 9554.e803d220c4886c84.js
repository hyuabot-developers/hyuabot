"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9554],{9554:(M,m,n)=>{n.r(m),n.d(m,{ShuttleTimetableModule:()=>Z});var l=n(5056),p=n(6895),g=n(4006),h=n(6753),c=n(7885),b=n(9671),d=n(4964),t=n(6353),T=n(7179),S=n(4471);const y=function(s,o){return{hour:s,minute:o}};function f(s,o){if(1&s&&(t.TgZ(0,"ion-item",11)(1,"ion-label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-text"),t._uU(5),t.ALo(6,"translate"),t.qZA()()),2&s){const e=o.$implicit,i=o.index,a=t.oxw();t.Q6J("lines",i===a.shuttleTimetableList.length-1?"none":"inset"),t.xp6(1),t.Tol(e.shuttleType),t.xp6(1),t.Oqu(t.lcZ(3,5,"shuttle.type."+e.shuttleType)),t.xp6(3),t.Oqu(t.xi3(6,7,"shuttle.timetable.item.all",t.WLB(10,y,e.shuttleTime.split(":")[0],e.shuttleTime.split(":")[1])))}}const v=d.Ps`
    query GetShuttlePeriod($currentDate: String!) {
      shuttle {
        weekday (date: $currentDate),
        period (date: $currentDate)
      }
    }
  `,w=d.Ps`
    query GetShuttleTimetable($period: String!) {
      shuttle {
        timetable (period: $period) {
          period, weekday, startStop, shuttleTime, shuttleType
        }
      }
    }
  `,D=[{path:"",component:(()=>{class s{constructor(e,i,a,u,r,k){this.route=e,this.apollo=i,this.toastController=a,this.translateService=u,this.shuttleService=r,this.loadingService=k,this.shuttleTimetableList=[],this.period="semester",this.now=new Date}ngOnInit(){const e=new Date;this.shuttleDateSubscription=this.apollo.watchQuery({query:v,variables:{currentDate:`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`}}).valueChanges.subscribe(({data:i})=>{this.period=i.shuttle.period,this.shuttleService.weekday.next(i.shuttle.weekday),this.shuttleDateSubscription?.unsubscribe(),this.shuttleTimetableQueryRef=this.apollo.watchQuery({query:w,pollInterval:6e4,variables:{period:this.period}}),this.shuttleTimetableSubscription=this.shuttleTimetableQueryRef.valueChanges.subscribe(({data:u,loading:r})=>{this.shuttleService.setLoading(r),this.shuttleService.setShuttleTimetable(u.shuttle.timetable),this.now=new Date,this.shuttleTimetableList=this.getShuttleTimetable()})}),this.shuttleService.loading.subscribe(i=>{i&&this.loadingService.present("shuttle.loading","shuttle.loading").then(()=>{this.shuttleService.loading.subscribe(a=>{a||this.loadingService.dismiss("shuttle.loading").then()})})}),this.shuttleService.weekday.subscribe(i=>{this.showCurrentWeekdays(i).then()}),this.route.queryParams.subscribe(i=>{this.destination=i.destination,this.stop=i.stop})}ngOnDestroy(){this.shuttleDateSubscription?.unsubscribe(),this.shuttleTimetableSubscription?.unsubscribe()}refreshShuttleTimetable(e){this.shuttleTimetableQueryRef.refetch().then(()=>{e.target.complete()})}getShuttleTimetable(){return console.log("fetching shuttle timetable"),this.shuttleService.shuttleTimetable.value.filter(e=>this.checkDestination(e)&&("dormitory"===e.startStop.toLowerCase()||"dormitory"!==this.stop)&&e.weekday===this.shuttleService.weekday.value).map(e=>({period:e.period,shuttleTime:this.addTimeDelta(e),shuttleType:e.shuttleType,startStop:e.startStop}))}changeWeekday(){this.shuttleService.weekday.next("weekdays"===this.shuttleService.weekday.value?"weekends":"weekdays")}checkDestination(e){return"station"===this.destination?"DH"===e.shuttleType||"C"===e.shuttleType:"terminal"===this.destination||"terminal"===this.stop?"DY"===e.shuttleType||"C"===e.shuttleType:"campus"===this.destination||"dormitory"===this.destination}calculateTimeDelta(e){switch(this.stop){case"dormitory":return-5;case"shuttlecock_o":return 0;case"station":return 10;case"terminal":return"DY"===e?10:15;case"shuttlecock_i":return"C"!==e?15:20;default:return 999}}addTimeDelta(e){const[i,a,u]=e.shuttleTime.split(":"),r=new Date(this.now.getFullYear(),this.now.getMonth(),this.now.getDate(),parseInt(i,10),parseInt(a,10));return r.setMinutes(r.getMinutes()+this.calculateTimeDelta(e.shuttleType)),String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0")}showCurrentWeekdays(e){var i=this;return(0,b.Z)(function*(){yield(yield i.toastController.create({message:i.translateService.instant("shuttle.timetable."+e),buttons:[{text:i.translateService.instant("OK"),role:"cancel"}],cssClass:"toast-closest-stop",duration:1500})).present()})()}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(c.gz),t.Y36(d._M),t.Y36(l.yF),t.Y36(h.sK),t.Y36(T.U),t.Y36(S.b))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-shuttle-timetable"]],decls:18,vars:9,consts:[[3,"translucent"],["slot","start"],["defaultHref","/shuttle"],[3,"fullscreen"],["collapse","condense"],["size","large"],["lines","inset"],[3,"lines",4,"ngFor","ngForOf"],["vertical","bottom","horizontal","end","slot","fixed",2,"margin-bottom","10px","margin-right","10px"],[3,"click"],["name","swap-horizontal-outline"],[3,"lines"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t._UZ(3,"ion-back-button",2),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA()()(),t.TgZ(7,"ion-content",3)(8,"ion-header",4)(9,"ion-toolbar")(10,"ion-title",5),t._uU(11),t.ALo(12,"translate"),t.qZA()()(),t.TgZ(13,"ion-list",6),t.YNc(14,f,7,13,"ion-item",7),t.qZA(),t.TgZ(15,"ion-fab",8)(16,"ion-fab-button",9),t.NdJ("click",function(){return i.changeWeekday()}),t._UZ(17,"ion-icon",10),t.qZA()()()),2&e&&(t.Q6J("translucent",!0),t.xp6(5),t.hij(" ",t.lcZ(6,5,"shuttle.timetable.title."+i.stop)," "),t.xp6(2),t.Q6J("fullscreen",!0),t.xp6(4),t.Oqu(t.lcZ(12,7,"shuttle.timetable.title."+i.stop)),t.xp6(3),t.Q6J("ngForOf",i.shuttleTimetableList))},dependencies:[l.oU,l.Sm,l.W2,l.IJ,l.W4,l.Gu,l.gu,l.Ie,l.Q$,l.q_,l.yW,l.wd,l.sr,l.cs,p.sg,h.X$],styles:["ion-list[_ngcontent-%COMP%]{padding:20px;margin-bottom:60px;--ion-item-background: var(--ion-background-color)}.DH[_ngcontent-%COMP%]{color:red;font-weight:700}.DY[_ngcontent-%COMP%]{color:green;font-weight:700}.C[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-weight:700}"]}),s})()}];let C=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[c.Bz.forChild(D),c.Bz]}),s})(),Z=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[l.Pc,p.ez,g.u5,h.aw,C]}),s})()}}]);